{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nvar ProskommaRender = require(\"./ProskommaRender\");\nvar camelCaseToSnakeCase = function camelCaseToSnakeCase(s) {\n  var ret = [];\n  for (var c of s.split(\"\")) {\n    if (c.toUpperCase() === c && c.toLowerCase() !== c) {\n      ret.push(\"_\" + c.toLowerCase());\n    } else {\n      ret.push(c);\n    }\n  }\n  return ret.join(\"\");\n};\nvar SofriaRenderFromProskomma2 = function (_ProskommaRender) {\n  _inherits(SofriaRenderFromProskomma2, _ProskommaRender);\n  var _super = _createSuper(SofriaRenderFromProskomma2);\n  function SofriaRenderFromProskomma2(spec) {\n    var _this;\n    _classCallCheck(this, SofriaRenderFromProskomma2);\n    _this = _super.call(this, spec);\n    if (!spec.proskomma) {\n      throw new Error(\"No Proskomma\");\n    }\n    _this.pk = spec.proskomma;\n    _this._tokens = [];\n    _this._container = null;\n    _this.cachedSequenceIds = [];\n    _this.sequences = null;\n    _this.currentCV = {\n      chapter: null,\n      verses: null\n    };\n    return _this;\n  }\n  _createClass(SofriaRenderFromProskomma2, [{\n    key: \"renderDocument1\",\n    value: function renderDocument1(_ref) {\n      var docId = _ref.docId,\n        config = _ref.config,\n        context = _ref.context,\n        workspace = _ref.workspace,\n        output = _ref.output;\n      var environment = {\n        config: config,\n        context: context,\n        workspace: workspace,\n        output: output\n      };\n      context.renderer = this;\n      var documentResult = this.pk.gqlQuerySync(\"{\\n          document(id: \\\"\" + docId + \"\\\") {\\n            docSetId\\n            mainSequence { id }\\n            nSequences\\n            sequences {\\n              id\\n              type\\n              nBlocks\\n            }\\n            headers {\\n              key\\n              value\\n            }\\n          } \\n        }\");\n      var docSetId = documentResult.data.document.docSetId;\n      var mainId = documentResult.data.document.mainSequence.id;\n      var nSequences = documentResult.data.document.nSequences;\n      this.sequences = {};\n      for (var seq of documentResult.data.document.sequences) {\n        this.sequences[seq.id] = seq;\n      }\n      var headers = {};\n      for (var header of documentResult.data.document.headers) {\n        headers[header.key] = header.value;\n      }\n      var docSetResult = this.pk.gqlQuerySync(\"{docSet(id: \\\"\" + docSetId + \"\\\") {selectors {key value}}}\");\n      var selectors = {};\n      for (var selector of docSetResult.data.docSet.selectors) {\n        selectors[selector.key] = selector.value;\n      }\n      context.document = {\n        id: docId,\n        schema: {\n          \"structure\": \"nested\",\n          \"structure_version\": \"0.2.1\",\n          \"constraints\": [{\n            \"name\": \"sofria\",\n            \"version\": \"0.2.1\"\n          }]\n        },\n        metadata: {\n          translation: {\n            id: docSetId,\n            selectors: selectors,\n            properties: {},\n            tags: []\n          },\n          document: _objectSpread(_objectSpread({}, headers), {}, {\n            properties: {},\n            tags: []\n          })\n        },\n        mainSequenceId: mainId,\n        nSequences: nSequences\n      };\n      if (config.chapters) {\n        context.document.metadata.document.properties.chapters = config.chapters[0];\n      }\n      context.sequences = [];\n      this.renderEvent('startDocument', environment);\n      this.cachedSequenceIds.unshift(mainId);\n      this.renderSequence(environment);\n      this.cachedSequenceIds.shift();\n      this.renderEvent('endDocument', environment);\n    }\n  }, {\n    key: \"renderBegeningOfDocument\",\n    value: function renderBegeningOfDocument(_ref2) {\n      var docId = _ref2.docId,\n        config = _ref2.config,\n        context = _ref2.context,\n        workspace = _ref2.workspace,\n        output = _ref2.output,\n        BlockToBegin = _ref2.BlockToBegin;\n      var environment = {\n        config: config,\n        context: context,\n        workspace: workspace,\n        output: output\n      };\n      context.renderer = this;\n      var documentResult = this.pk.gqlQuerySync(\"{\\n          document(id: \\\"\" + docId + \"\\\") {\\n            docSetId\\n            mainSequence { id }\\n            nSequences\\n            sequences {\\n              id\\n              type\\n              nBlocks\\n            }\\n            headers {\\n              key\\n              value\\n            }\\n          } \\n        }\");\n      var docSetId = documentResult.data.document.docSetId;\n      var mainId = documentResult.data.document.mainSequence.id;\n      var nSequences = documentResult.data.document.nSequences;\n      this.sequences = {};\n      for (var seq of documentResult.data.document.sequences) {\n        this.sequences[seq.id] = seq;\n      }\n      var headers = {};\n      for (var header of documentResult.data.document.headers) {\n        headers[header.key] = header.value;\n      }\n      var docSetResult = this.pk.gqlQuerySync(\"{docSet(id: \\\"\" + docSetId + \"\\\") {selectors {key value}}}\");\n      var selectors = {};\n      for (var selector of docSetResult.data.docSet.selectors) {\n        selectors[selector.key] = selector.value;\n      }\n      context.document = {\n        id: docId,\n        schema: {\n          \"structure\": \"nested\",\n          \"structure_version\": \"0.2.1\",\n          \"constraints\": [{\n            \"name\": \"sofria\",\n            \"version\": \"0.2.1\"\n          }]\n        },\n        metadata: {\n          translation: {\n            id: docSetId,\n            selectors: selectors,\n            properties: {},\n            tags: []\n          },\n          document: _objectSpread(_objectSpread({}, headers), {}, {\n            properties: {},\n            tags: []\n          })\n        },\n        mainSequenceId: mainId,\n        nSequences: nSequences\n      };\n      if (config.chapters) {\n        context.document.metadata.document.properties.chapters = config.chapters[0];\n      }\n      context.sequences = [];\n      this.renderEvent('startDocument', environment);\n      this.cachedSequenceIds.unshift(mainId);\n      this.renderSequence(environment, 0, BlockToBegin, true);\n      this.cachedSequenceIds.shift();\n      this.renderEvent('endDocument', environment);\n    }\n  }, {\n    key: \"renderOtherPartOfDocument\",\n    value: function renderOtherPartOfDocument(_ref3) {\n      var docId = _ref3.docId,\n        config = _ref3.config,\n        context = _ref3.context,\n        workspace = _ref3.workspace,\n        output = _ref3.output,\n        numberToRender = _ref3.numberToRender;\n      var environment = {\n        config: config,\n        context: context,\n        workspace: workspace,\n        output: output\n      };\n      context.renderer = this;\n      var documentResult = this.pk.gqlQuerySync(\"{\\n          document(id: \\\"\" + docId + \"\\\") {\\n            docSetId\\n            mainSequence { id }\\n            nSequences\\n            sequences {\\n              id\\n              type\\n              nBlocks\\n            }\\n            headers {\\n              key\\n              value\\n            }\\n          } \\n        }\");\n      var docSetId = documentResult.data.document.docSetId;\n      var mainId = documentResult.data.document.mainSequence.id;\n      var nSequences = documentResult.data.document.nSequences;\n      this.sequences = {};\n      for (var seq of documentResult.data.document.sequences) {\n        this.sequences[seq.id] = seq;\n      }\n      var docSetResult = this.pk.gqlQuerySync(\"{docSet(id: \\\"\" + docSetId + \"\\\") {selectors {key value}}}\");\n      var selectors = {};\n      for (var selector of docSetResult.data.docSet.selectors) {\n        selectors[selector.key] = selector.value;\n      }\n      context.document = {\n        id: docId,\n        schema: {\n          \"structure\": \"nested\",\n          \"structure_version\": \"0.2.1\",\n          \"constraints\": [{\n            \"name\": \"sofria\",\n            \"version\": \"0.2.1\"\n          }]\n        },\n        metadata: {\n          translation: {\n            id: docSetId,\n            selectors: selectors,\n            properties: {},\n            tags: []\n          }\n        },\n        mainSequenceId: mainId,\n        nSequences: nSequences\n      };\n      if (config.chapters) {\n        context.document.metadata.document.properties.chapters = config.chapters[0];\n      }\n      context.sequences = [];\n      this.testAddingSequence(mainId, environment, workspace.webParas.length, workspace.webParas.length + numberToRender);\n      this.renderEvent('endDocument', environment);\n    }\n  }, {\n    key: \"testAddingSequence\",\n    value: function testAddingSequence(mainId, environment, fromId, toId) {\n      this.cachedSequenceIds.unshift(mainId);\n      this.renderSequence(environment, fromId, toId, true);\n      this.cachedSequenceIds.shift();\n    }\n  }, {\n    key: \"sequenceContext\",\n    value: function sequenceContext(sequence, sequenceId) {\n      return {\n        id: sequenceId,\n        type: camelCaseToSnakeCase(sequence.type),\n        nBlocks: sequence.nBlocks,\n        milestones: new Set([])\n      };\n    }\n  }, {\n    key: \"renderSequence\",\n    value: function renderSequence(environment) {\n      var useBlockNumber = false;\n      var fromBlockNumber = 0;\n      var toBlockNumber = 0;\n      if (environment.config !== null) {\n        useBlockNumber = true;\n        fromBlockNumber = environment.config.startBlock;\n        toBlockNumber = environment.config.endBlock;\n      }\n      var context = environment.context;\n      var sequenceId = this.cachedSequenceIds[0];\n      var sequenceType = this.pk.gqlQuerySync(\"{document(id: \\\"\" + context.document.id + \"\\\") {sequence(id:\\\"\" + sequenceId + \"\\\") {type} } }\").data.document.sequence.type;\n      var documentResult = {};\n      if (useBlockNumber) {\n        if (sequenceType === 'main') {\n          var myList = [];\n          for (var i = fromBlockNumber; i < toBlockNumber - fromBlockNumber; i++) {\n            myList += [i + \" ,\"];\n          }\n          documentResult = this.pk.gqlQuerySync(\"{document(id: \\\"\" + context.document.id + \"\\\") {id sequence(id:\\\"\" + sequenceId + \"\\\") {id type nBlocks blocks(positions: [\" + myList + \"]){ os {payload} is {payload} } } } }\");\n        } else {\n          documentResult = this.pk.gqlQuerySync(\"{document(id: \\\"\" + context.document.id + \"\\\") {sequence(id:\\\"\" + sequenceId + \"\\\") {id type nBlocks blocks { os {payload} is {payload} } } } }\");\n        }\n      } else {\n        documentResult = this.pk.gqlQuerySync(\"{document(id: \\\"\" + context.document.id + \"\\\") {sequence(id:\\\"\" + sequenceId + \"\\\") {id type nBlocks blocks { os {payload} is {payload} } } } }\");\n      }\n      var sequence = documentResult.data.document.sequence;\n      if (!sequence) {\n        throw new Error(\"Sequence '\" + sequenceId + \"' not found in renderSequenceId()\");\n      }\n      context.sequences.unshift(this.sequenceContext(sequence, sequenceId));\n      this.renderEvent('startSequence', environment);\n      var outputBlockN = 0;\n      var nbForLoop = 0;\n      var initBlockNumber = 0;\n      if (useBlockNumber) {\n        if (sequence.type === 'main') {\n          nbForLoop = toBlockNumber;\n          initBlockNumber = fromBlockNumber;\n        } else {\n          nbForLoop = sequence.nBlocks;\n        }\n      } else {\n        nbForLoop = sequence.nBlocks;\n      }\n      for (var inputBlockN = initBlockNumber; inputBlockN < nbForLoop; inputBlockN++) {\n        if (environment.config.chapters && sequence.type === \"main\") {\n          var chapterScopes = [].concat(_toConsumableArray(sequence.blocks[inputBlockN].os.map(function (s) {\n            return s.payload;\n          })), _toConsumableArray(sequence.blocks[inputBlockN].is.map(function (s) {\n            return s.payload;\n          }))).filter(function (s) {\n            return ['chapter'].includes(s.split('/')[0]);\n          }).map(function (s) {\n            return s.split('/')[1];\n          });\n          if (chapterScopes.length === 0 || !environment.config.chapters.includes(chapterScopes[0])) {\n            continue;\n          }\n        }\n        var blocksResult = this.pk.gqlQuerySync(\"{\\n               document(id: \\\"\" + context.document.id + \"\\\") {\\n                 sequence(id:\\\"\" + sequenceId + \"\\\") {\\n                   blocks(positions:\" + inputBlockN + \") {\\n                     bg {subType payload}\\n                     bs {payload}\\n                     items {type subType payload}\\n                   }\\n                 }\\n               }\\n             }\");\n        var blockResult = blocksResult.data.document.sequence.blocks[0];\n        for (var blockGraft of blockResult.bg) {\n          context.sequences[0].block = {\n            type: \"graft\",\n            subType: camelCaseToSnakeCase(blockGraft.subType),\n            blockN: outputBlockN,\n            sequence: this.sequences[blockGraft.payload]\n          };\n          this.cachedSequenceIds.unshift(blockGraft.payload);\n          this.renderEvent('blockGraft', environment);\n          this.cachedSequenceIds.shift();\n          outputBlockN++;\n        }\n        var subTypeValues = blockResult.bs.payload.split('/');\n        var subTypeValue = subTypeValues[1] ? \"usfm:\" + subTypeValues[1] : subTypeValues[0];\n        context.sequences[0].block = {\n          type: \"paragraph\",\n          subType: subTypeValue,\n          blockN: outputBlockN,\n          wrappers: []\n        };\n        this.renderEvent('startParagraph', environment);\n        this._tokens = [];\n        if (sequence.type === \"main\" && this.currentCV.chapter) {\n          var wrapper = {\n            type: \"wrapper\",\n            subType: 'chapter',\n            atts: {\n              number: this.currentCV.chapter\n            }\n          };\n          environment.context.sequences[0].element = wrapper;\n          environment.context.sequences[0].block.wrappers.unshift(wrapper.subType);\n          this.renderEvent('startWrapper', environment);\n        }\n        if (sequence.type === \"main\" && this.currentCV.verses) {\n          var _wrapper = {\n            type: \"wrapper\",\n            subType: 'verses',\n            atts: {\n              number: this.currentCV.verses\n            }\n          };\n          environment.context.sequences[0].element = _wrapper;\n          environment.context.sequences[0].block.wrappers.unshift(_wrapper.subType);\n          this.renderEvent('startWrapper', environment);\n        }\n        this.renderContent(blockResult.items, environment);\n        this._tokens = [];\n        if (sequence.type === \"main\" && this.currentCV.verses) {\n          var _wrapper2 = {\n            type: \"wrapper\",\n            subType: 'verses',\n            atts: {\n              number: this.currentCV.verses\n            }\n          };\n          environment.context.sequences[0].element = _wrapper2;\n          environment.context.sequences[0].block.wrappers.shift();\n          this.renderEvent('endWrapper', environment);\n        }\n        if (sequence.type === \"main\" && this.currentCV.chapter) {\n          var _wrapper3 = {\n            type: \"wrapper\",\n            subType: 'chapter',\n            atts: {\n              number: this.currentCV.chapter\n            }\n          };\n          environment.context.sequences[0].element = _wrapper3;\n          environment.context.sequences[0].block.wrappers.shift();\n          this.renderEvent('endWrapper', environment);\n        }\n        this.renderEvent('endParagraph', environment);\n        delete context.sequences[0].block;\n        outputBlockN++;\n      }\n      this.renderEvent('endSequence', environment);\n      context.sequences.shift();\n    }\n  }, {\n    key: \"renderContent\",\n    value: function renderContent(items, environment) {\n      for (var item of items) {\n        this.renderItem(item, environment);\n      }\n      this.maybeRenderText(environment);\n    }\n  }, {\n    key: \"renderItem\",\n    value: function renderItem(item, environment) {\n      if (item.type === 'scope' && item.payload.startsWith('attribute')) {\n        var scopeBits = item.payload.split('/');\n        if (item.subType === \"start\") {\n          if (!this._container) {\n            this._container = {\n              direction: \"start\",\n              subType: \"usfm:w\",\n              type: \"wrapper\",\n              atts: {}\n            };\n          }\n          if (scopeBits[3] in this._container.atts) {\n            this._container.atts[scopeBits[3]].push(scopeBits[5]);\n          } else {\n            this._container.atts[scopeBits[3]] = [scopeBits[5]];\n          }\n        } else {\n          if (!this._container) {\n            this._container = {\n              direction: \"end\",\n              subType: \"usfm:\" + camelCaseToSnakeCase(scopeBits[2])\n            };\n            if (scopeBits[1] === 'milestone') {\n              this._container.type = \"end_milestone\";\n            } else {\n              this._container.type = \"wrapper\";\n              this._container.atts = {};\n            }\n          }\n        }\n      } else {\n        if (this._container) {\n          this.maybeRenderText(environment);\n          this.renderContainer(environment);\n        }\n        if (item.type === 'token') {\n          this._tokens.push(item.payload.replace(/\\s+/g, \" \"));\n        } else if (item.type === \"graft\") {\n          this.maybeRenderText(environment);\n          var graft = {\n            type: \"graft\",\n            subType: camelCaseToSnakeCase(item.subType),\n            sequence: this.sequences[item.payload]\n          };\n          environment.context.sequences[0].element = graft;\n          this.cachedSequenceIds.unshift(item.payload);\n          this.renderEvent('inlineGraft', environment);\n          this.cachedSequenceIds.shift();\n          delete environment.context.sequences[0].element;\n        } else {\n          this.maybeRenderText(environment);\n          var _scopeBits = item.payload.split('/');\n          if ([\"chapter\", \"verses\"].includes(_scopeBits[0])) {\n            var wrapper = {\n              type: \"wrapper\",\n              subType: camelCaseToSnakeCase(_scopeBits[0]),\n              atts: {\n                number: _scopeBits[1]\n              }\n            };\n            environment.context.sequences[0].element = wrapper;\n            if (item.subType === 'start') {\n              this.currentCV[_scopeBits[0]] = _scopeBits[1];\n              environment.context.sequences[0].block.wrappers.unshift(wrapper.subType);\n              this.renderEvent('startWrapper', environment);\n              var cvMark = {\n                \"type\": \"mark\",\n                \"subType\": _scopeBits[0] + \"_label\",\n                \"atts\": {\n                  \"number\": _scopeBits[1]\n                }\n              };\n              environment.context.sequences[0].element = cvMark;\n              this.renderEvent('mark', environment);\n              environment.context.sequences[0].element = wrapper;\n            } else {\n              this.renderEvent('endWrapper', environment);\n              environment.context.sequences[0].block.wrappers.shift();\n              delete environment.context.sequences[0].element;\n              this.currentCV[_scopeBits[0]] = null;\n            }\n          } else if ([\"pubChapter\", \"pubVerse\", \"altChapter\", \"altVerse\"].includes(_scopeBits[0])) {\n            if (item.subType === 'start') {\n              var mark = {\n                type: \"mark\",\n                subType: camelCaseToSnakeCase(_scopeBits[0]),\n                atts: {\n                  number: _scopeBits[1]\n                }\n              };\n              environment.context.sequences[0].element = mark;\n              this.renderEvent('mark', environment);\n              delete environment.context.sequences[0].element;\n            }\n          } else if (_scopeBits[0] === 'span') {\n            var _wrapper4 = {\n              type: \"wrapper\",\n              subType: \"usfm:\" + _scopeBits[1],\n              atts: {}\n            };\n            environment.context.sequences[0].element = _wrapper4;\n            if (item.subType === 'start') {\n              environment.context.sequences[0].block.wrappers.unshift(_wrapper4.subType);\n              this.renderEvent('startWrapper', environment);\n            } else {\n              this.renderEvent('endWrapper', environment);\n              environment.context.sequences[0].block.wrappers.shift();\n            }\n            delete environment.context.sequences[0].element;\n          } else if (_scopeBits[0] === 'spanWithAtts') {\n            if (item.subType === 'start') {\n              this._container = {\n                direction: \"start\",\n                type: \"wrapper\",\n                subType: \"usfm:\" + _scopeBits[1],\n                atts: {}\n              };\n            }\n          } else if (_scopeBits[0] === 'milestone' && item.subType === \"start\") {\n            if (_scopeBits[1] === 'ts') {\n              var _mark = {\n                type: \"mark\",\n                subType: \"usfm:\" + camelCaseToSnakeCase(_scopeBits[1]),\n                atts: {}\n              };\n              environment.context.sequences[0].element = _mark;\n              this.renderEvent('mark', environment);\n              delete environment.context.sequences[0].element;\n            } else {\n              this._container = {\n                type: \"start_milestone\",\n                subType: \"usfm:\" + camelCaseToSnakeCase(_scopeBits[1]),\n                atts: {}\n              };\n            }\n          }\n        }\n      }\n    }\n  }, {\n    key: \"maybeRenderText\",\n    value: function maybeRenderText(environment) {\n      if (this._tokens.length === 0) {\n        return;\n      }\n      var elementContext = {\n        type: 'text',\n        text: this._tokens.join('')\n      };\n      environment.context.sequences[0].element = elementContext;\n      this._tokens = [];\n      this.renderEvent('text', environment);\n      delete environment.context.sequences[0].element;\n    }\n  }, {\n    key: \"renderContainer\",\n    value: function renderContainer(environment) {\n      if (this._container.type === \"wrapper\") {\n        var direction = this._container.direction;\n        delete this._container.direction;\n        if (direction === 'start') {\n          environment.context.sequences[0].element = this._container;\n          environment.context.sequences[0].block.wrappers.unshift(this._container.subType);\n          this.renderEvent('startWrapper', environment);\n          delete environment.context.sequences[0].element;\n        } else {\n          environment.context.sequences[0].element = this._container;\n          this.renderEvent('endWrapper', environment);\n          environment.context.sequences[0].block.wrappers.shift();\n          delete environment.context.sequences[0].element;\n        }\n      } else if (this._container.type === \"start_milestone\") {\n        environment.context.sequences[0].element = this._container;\n        this.renderEvent('startMilestone', environment);\n        delete environment.context.sequences[0].element;\n      } else if (this._container.type === \"end_milestone\") {\n        environment.context.sequences[0].element = this._container;\n        this.renderEvent('endMilestone', environment);\n        delete environment.context.sequences[0].element;\n      }\n      this._container = null;\n    }\n  }]);\n  return SofriaRenderFromProskomma2;\n}(ProskommaRender);\nexport { SofriaRenderFromProskomma2 };","map":{"version":3,"names":["ProskommaRender","require","camelCaseToSnakeCase","s","ret","c","split","toUpperCase","toLowerCase","push","join","SofriaRenderFromProskomma2","_ProskommaRender","_inherits","_super","_createSuper","spec","_this","_classCallCheck","call","proskomma","Error","pk","_tokens","_container","cachedSequenceIds","sequences","currentCV","chapter","verses","_createClass","key","value","renderDocument1","_ref","docId","config","context","workspace","output","environment","renderer","documentResult","gqlQuerySync","docSetId","data","document","mainId","mainSequence","id","nSequences","seq","headers","header","docSetResult","selectors","selector","docSet","schema","metadata","translation","properties","tags","_objectSpread","mainSequenceId","chapters","renderEvent","unshift","renderSequence","shift","renderBegeningOfDocument","_ref2","BlockToBegin","renderOtherPartOfDocument","_ref3","numberToRender","testAddingSequence","webParas","length","fromId","toId","sequenceContext","sequence","sequenceId","type","nBlocks","milestones","Set","useBlockNumber","fromBlockNumber","toBlockNumber","startBlock","endBlock","sequenceType","myList","i","outputBlockN","nbForLoop","initBlockNumber","inputBlockN","chapterScopes","concat","_toConsumableArray","blocks","os","map","payload","is","filter","includes","blocksResult","blockResult","blockGraft","bg","block","subType","blockN","subTypeValues","bs","subTypeValue","wrappers","wrapper","atts","number","element","renderContent","items","item","renderItem","maybeRenderText","startsWith","scopeBits","direction","renderContainer","replace","graft","cvMark","mark","elementContext","text"],"sources":["/home/gabriel/repos/jxt-korennumi/components/ProskommaRendererTest.js"],"sourcesContent":["const ProskommaRender = require('./ProskommaRender');\n\nconst camelCaseToSnakeCase = s => {\n    const ret = [];\n    for (const c of s.split(\"\")) {\n        if (c.toUpperCase() === c && c.toLowerCase() !== c) {\n            ret.push(`_${c.toLowerCase()}`);\n        } else {\n            ret.push(c);\n        }\n    }\n    return ret.join(\"\");\n}\n\nclass SofriaRenderFromProskomma2 extends ProskommaRender {\n\n    constructor(spec) {\n        super(spec);\n        if (!spec.proskomma) {\n            throw new Error(`No Proskomma`)\n        }\n        this.pk = spec.proskomma;\n        this._tokens = [];\n        this._container = null;\n        this.cachedSequenceIds = [];\n        this.sequences = null;\n        this.currentCV = {\n            chapter: null,\n            verses: null\n        }\n    }\n    renderDocument1({docId, config, context, workspace, output}){\n        const environment = {config, context, workspace, output};\n        context.renderer = this;\n        const documentResult = this.pk.gqlQuerySync(`{\n          document(id: \"${docId}\") {\n            docSetId\n            mainSequence { id }\n            nSequences\n            sequences {\n              id\n              type\n              nBlocks\n            }\n            headers {\n              key\n              value\n            }\n          } \n        }`);\n        const docSetId = documentResult.data.document.docSetId;\n        const mainId = documentResult.data.document.mainSequence.id;\n        const nSequences = documentResult.data.document.nSequences;\n        this.sequences = {};\n        for (const seq of documentResult.data.document.sequences) {\n            this.sequences[seq.id] = seq;\n        }\n        const headers = {};\n        for (const header of documentResult.data.document.headers) {\n            headers[header.key] = header.value;\n        }\n        const docSetResult = this.pk.gqlQuerySync(`{docSet(id: \"${docSetId}\") {selectors {key value}}}`);\n        const selectors = {};\n        for (const selector of docSetResult.data.docSet.selectors) {\n            selectors[selector.key] = selector.value;\n        }\n        context.document = {\n            id: docId,\n            schema: {\n                \"structure\": \"nested\",\n                \"structure_version\": \"0.2.1\",\n                \"constraints\": [\n                    {\n                        \"name\": \"sofria\",\n                        \"version\": \"0.2.1\"\n                    }\n                ]\n            },\n\n            metadata: {\n                translation: {\n                    id: docSetId,\n                    selectors,\n                    properties: {},\n                    tags: []\n                },\n                document: {\n                    ...headers,\n                    properties: {},\n                    tags: []\n                }\n            },\n            mainSequenceId: mainId,\n            nSequences,\n        };\n        if (config.chapters) {\n            context.document.metadata.document.properties.chapters = config.chapters[0];\n        }\n        context.sequences = [];\n        this.renderEvent('startDocument', environment);\n        this.cachedSequenceIds.unshift(mainId);\n        this.renderSequence(environment);\n        this.cachedSequenceIds.shift();\n        this.renderEvent('endDocument', environment);\n        \n    }\n    renderBegeningOfDocument({docId, config, context, workspace, output,BlockToBegin}) {\n        const environment = {config, context, workspace, output};\n        context.renderer = this;\n        const documentResult = this.pk.gqlQuerySync(`{\n          document(id: \"${docId}\") {\n            docSetId\n            mainSequence { id }\n            nSequences\n            sequences {\n              id\n              type\n              nBlocks\n            }\n            headers {\n              key\n              value\n            }\n          } \n        }`);\n        const docSetId = documentResult.data.document.docSetId;\n        const mainId = documentResult.data.document.mainSequence.id;\n        const nSequences = documentResult.data.document.nSequences;\n        this.sequences = {};\n        for (const seq of documentResult.data.document.sequences) {\n            this.sequences[seq.id] = seq;\n        }\n        const headers = {};\n        for (const header of documentResult.data.document.headers) {\n            headers[header.key] = header.value;\n        }\n        const docSetResult = this.pk.gqlQuerySync(`{docSet(id: \"${docSetId}\") {selectors {key value}}}`);\n        const selectors = {};\n        for (const selector of docSetResult.data.docSet.selectors) {\n            selectors[selector.key] = selector.value;\n        }\n        context.document = {\n            id: docId,\n            schema: {\n                \"structure\": \"nested\",\n                \"structure_version\": \"0.2.1\",\n                \"constraints\": [\n                    {\n                        \"name\": \"sofria\",\n                        \"version\": \"0.2.1\"\n                    }\n                ]\n            },\n\n            metadata: {\n                translation: {\n                    id: docSetId,\n                    selectors,\n                    properties: {},\n                    tags: []\n                },\n                document: {\n                    ...headers,\n                    properties: {},\n                    tags: []\n                }\n            },\n            mainSequenceId: mainId,\n            nSequences,\n        };\n        if (config.chapters) {\n            context.document.metadata.document.properties.chapters = config.chapters[0];\n        }\n        context.sequences = [];\n        this.renderEvent('startDocument', environment);\n        this.cachedSequenceIds.unshift(mainId);\n        this.renderSequence(environment,0,BlockToBegin,true);\n        this.cachedSequenceIds.shift();\n        this.renderEvent('endDocument', environment);\n        \n    }\n\n    renderOtherPartOfDocument({docId, config, context, workspace, output, numberToRender}) {\n        const environment = {config, context, workspace, output};\n        context.renderer = this;\n        const documentResult = this.pk.gqlQuerySync(`{\n          document(id: \"${docId}\") {\n            docSetId\n            mainSequence { id }\n            nSequences\n            sequences {\n              id\n              type\n              nBlocks\n            }\n            headers {\n              key\n              value\n            }\n          } \n        }`);\n        const docSetId = documentResult.data.document.docSetId;\n        const mainId = documentResult.data.document.mainSequence.id;\n        const nSequences = documentResult.data.document.nSequences;\n        this.sequences = {};\n        for (const seq of documentResult.data.document.sequences) {\n            this.sequences[seq.id] = seq;\n        }\n        const docSetResult = this.pk.gqlQuerySync(`{docSet(id: \"${docSetId}\") {selectors {key value}}}`);\n        const selectors = {};\n        for (const selector of docSetResult.data.docSet.selectors) {\n            selectors[selector.key] = selector.value;\n        }\n        context.document = {\n            id: docId,\n            schema: {\n                \"structure\": \"nested\",\n                \"structure_version\": \"0.2.1\",\n                \"constraints\": [\n                    {\n                        \"name\": \"sofria\",\n                        \"version\": \"0.2.1\"\n                    }\n                ]\n            },\n\n            metadata: {\n                translation: {\n                    id: docSetId,\n                    selectors,\n                    properties: {},\n                    tags: []\n                },\n            \n            },\n            mainSequenceId: mainId,\n            nSequences,\n        };\n        if (config.chapters) {\n            context.document.metadata.document.properties.chapters = config.chapters[0];\n        }\n        context.sequences = [];\n\n        this.testAddingSequence(mainId,environment,workspace.webParas.length,workspace.webParas.length + numberToRender);\n        this.renderEvent('endDocument', environment);\n        \n    }\n    testAddingSequence(mainId,environment,fromId,toId){\n        this.cachedSequenceIds.unshift(mainId);\n        this.renderSequence(environment,fromId,toId,true);\n        this.cachedSequenceIds.shift();\n    }\n\n    sequenceContext(sequence, sequenceId) {\n        return {\n            id: sequenceId,\n            type: camelCaseToSnakeCase(sequence.type),\n            nBlocks: sequence.nBlocks,\n            milestones: new Set([]),\n        }\n    }\n\n    renderSequence(environment) {\n        let useBlockNumber = false;\n        let fromBlockNumber = 0;\n        let toBlockNumber = 0;\n        if(environment.config !== null){\n            useBlockNumber = true;\n            fromBlockNumber = environment.config.startBlock;\n            toBlockNumber = environment.config.endBlock;\n        }\n        \n        const context = environment.context;\n        const sequenceId = this.cachedSequenceIds[0];\n        const sequenceType = this.pk.gqlQuerySync(`{document(id: \"${context.document.id}\") {sequence(id:\"${sequenceId}\") {type} } }`).data.document.sequence.type;\n        let documentResult = {};\n        if(useBlockNumber){      \n            if(sequenceType === 'main'){\n                let myList = [];\n                for(let i = fromBlockNumber; i< toBlockNumber-fromBlockNumber; i++){\n                    myList += [`${i} ,`];\n                }\n                \n\n                documentResult = this.pk.gqlQuerySync(`{document(id: \"${context.document.id}\") {id sequence(id:\"${sequenceId}\") {id type nBlocks blocks(positions: [${myList}]){ os {payload} is {payload} } } } }`);\n            }\n            else{\n                documentResult = this.pk.gqlQuerySync(`{document(id: \"${context.document.id}\") {sequence(id:\"${sequenceId}\") {id type nBlocks blocks { os {payload} is {payload} } } } }`);\n\n            }\n        }\n        else{\n            documentResult = this.pk.gqlQuerySync(`{document(id: \"${context.document.id}\") {sequence(id:\"${sequenceId}\") {id type nBlocks blocks { os {payload} is {payload} } } } }`);\n        }\n        const sequence = documentResult.data.document.sequence;\n\n        if (!sequence) {\n            throw new Error(`Sequence '${sequenceId}' not found in renderSequenceId()`);\n        }\n        context.sequences.unshift(this.sequenceContext(sequence, sequenceId));\n        \n        this.renderEvent('startSequence', environment);\n        let outputBlockN = 0;\n        let nbForLoop = 0;\n        let initBlockNumber = 0;\n        if(useBlockNumber){\n            if(sequence.type === 'main'){\n                nbForLoop = toBlockNumber;\n                initBlockNumber = fromBlockNumber;\n            }\n            else{\n                nbForLoop=sequence.nBlocks\n            }\n        }\n        else{\n            nbForLoop = sequence.nBlocks\n        }\n        \n        for (let inputBlockN = initBlockNumber; inputBlockN < nbForLoop; inputBlockN++) {\n            if (environment.config.chapters && sequence.type === \"main\") {\n                const chapterScopes = [\n                    ...sequence.blocks[inputBlockN].os.map(s => s.payload),\n                    ...sequence.blocks[inputBlockN].is.map(s => s.payload)\n                ].filter(\n                    s => ['chapter'].includes(s.split('/')[0])\n                ).map(\n                    s => s.split('/')[1]\n                );\n                if (chapterScopes.length === 0 || !environment.config.chapters.includes(chapterScopes[0])) {\n                    continue;\n                }\n            }\n            \n            const blocksResult = this.pk.gqlQuerySync(\n                `{\n               document(id: \"${context.document.id}\") {\n                 sequence(id:\"${sequenceId}\") {\n                   blocks(positions:${inputBlockN}) {\n                     bg {subType payload}\n                     bs {payload}\n                     items {type subType payload}\n                   }\n                 }\n               }\n             }`\n            );\n            const blockResult = blocksResult.data.document.sequence.blocks[0];\n            for (const blockGraft of blockResult.bg) {\n                context.sequences[0].block = {\n                    type: \"graft\",\n                    subType: camelCaseToSnakeCase(blockGraft.subType),\n                    blockN: outputBlockN,\n                    sequence: this.sequences[blockGraft.payload]\n                }\n                this.cachedSequenceIds.unshift(blockGraft.payload);\n                this.renderEvent('blockGraft', environment);\n                this.cachedSequenceIds.shift();\n                outputBlockN++;\n            }\n            const subTypeValues = blockResult.bs.payload.split('/');\n            let subTypeValue = subTypeValues[1]? `usfm:${subTypeValues[1]}` : subTypeValues[0];\n            context.sequences[0].block = {\n                type: \"paragraph\",\n                subType: subTypeValue,\n                blockN: outputBlockN,\n                wrappers: []\n            }\n            this.renderEvent('startParagraph', environment);\n            this._tokens = [];\n            if (sequence.type === \"main\" && this.currentCV.chapter) {\n                const wrapper = {\n                    type: \"wrapper\",\n                    subType: 'chapter',\n                    atts: {\n                        number: this.currentCV.chapter\n                    }\n                };\n                environment.context.sequences[0].element = wrapper;\n                environment.context.sequences[0].block.wrappers.unshift(wrapper.subType);\n                this.renderEvent('startWrapper', environment);\n            }\n            if (sequence.type === \"main\" && this.currentCV.verses) {\n                const wrapper = {\n                    type: \"wrapper\",\n                    subType: 'verses',\n                    atts: {\n                        number: this.currentCV.verses\n                    }\n                };\n                environment.context.sequences[0].element = wrapper;\n                environment.context.sequences[0].block.wrappers.unshift(wrapper.subType);\n                this.renderEvent('startWrapper', environment);\n            }\n            this.renderContent(blockResult.items, environment);\n            this._tokens = [];\n            if (sequence.type === \"main\" && this.currentCV.verses) {\n                const wrapper = {\n                    type: \"wrapper\",\n                    subType: 'verses',\n                    atts: {\n                        number: this.currentCV.verses\n                    }\n                };\n                environment.context.sequences[0].element = wrapper;\n                environment.context.sequences[0].block.wrappers.shift();\n                this.renderEvent('endWrapper', environment);\n            }\n            if (sequence.type === \"main\" && this.currentCV.chapter) {\n                const wrapper = {\n                    type: \"wrapper\",\n                    subType: 'chapter',\n                    atts: {\n                        number: this.currentCV.chapter\n                    }\n                };\n                environment.context.sequences[0].element = wrapper;\n                environment.context.sequences[0].block.wrappers.shift();\n                this.renderEvent('endWrapper', environment);\n            }\n            this.renderEvent('endParagraph', environment);\n            delete context.sequences[0].block;\n            outputBlockN++;\n        }\n        this.renderEvent('endSequence', environment);\n        context.sequences.shift();\n        \n    }\n\n    renderContent(items, environment) {\n        for (const item of items) {\n            this.renderItem(item, environment);\n        }\n        this.maybeRenderText(environment);\n    }\n\n    renderItem(item, environment) {\n        if (item.type === 'scope' && item.payload.startsWith('attribute')) {\n            const scopeBits = item.payload.split('/');\n            if (item.subType === \"start\") {\n                if (!this._container) {\n                    this._container = {\n                        direction: \"start\",\n                        subType: `usfm:w`,\n                        type: \"wrapper\",\n                        atts: {}\n                    };\n                }\n                if (scopeBits[3] in this._container.atts) {\n                    this._container.atts[scopeBits[3]].push(scopeBits[5]);\n                } else {\n                    this._container.atts[scopeBits[3]] = [scopeBits[5]];\n                }\n            } else {\n                if (!this._container) {\n                    this._container = {\n                        direction: \"end\",\n                        subType: `usfm:${camelCaseToSnakeCase(scopeBits[2])}`,\n                    };\n                    if(scopeBits[1] === 'milestone') {\n                        this._container.type = \"end_milestone\";\n                    } else {\n                        this._container.type = \"wrapper\";\n                        this._container.atts = {};\n                    }\n                }\n            }\n        } else {\n            if (this._container) {\n                this.maybeRenderText(environment);\n                this.renderContainer(environment);\n            }\n            if (item.type === 'token') {\n                this._tokens.push(item.payload.replace(/\\s+/g, \" \"));\n            } else if (item.type === \"graft\") {\n                this.maybeRenderText(environment);\n                const graft = {\n                    type: \"graft\",\n                    subType: camelCaseToSnakeCase(item.subType),\n                    sequence: this.sequences[item.payload],\n                };\n                environment.context.sequences[0].element = graft;\n                this.cachedSequenceIds.unshift(item.payload);\n                this.renderEvent('inlineGraft', environment);\n                this.cachedSequenceIds.shift();\n                delete environment.context.sequences[0].element;\n            } else { // scope\n                this.maybeRenderText(environment);\n                const scopeBits = item.payload.split('/');\n                if ([\"chapter\", \"verses\"].includes(scopeBits[0])) {\n                    const wrapper = {\n                        type: \"wrapper\",\n                        subType: camelCaseToSnakeCase(scopeBits[0]),\n                        atts: {\n                            number: scopeBits[1]\n                        }\n                    };\n                    environment.context.sequences[0].element = wrapper;\n                    if (item.subType === 'start') {\n                        this.currentCV[scopeBits[0]] = scopeBits[1];\n                        environment.context.sequences[0].block.wrappers.unshift(wrapper.subType);\n                        this.renderEvent('startWrapper', environment);\n                        const cvMark = {\n                            \"type\": \"mark\",\n                            \"subType\": `${scopeBits[0]}_label`,\n                            \"atts\": {\n                                \"number\": scopeBits[1]\n                            }\n                        };\n                        environment.context.sequences[0].element = cvMark;\n                        this.renderEvent('mark', environment);\n                        environment.context.sequences[0].element = wrapper;\n                    } else {\n                        this.renderEvent('endWrapper', environment);\n                        environment.context.sequences[0].block.wrappers.shift();\n                        delete environment.context.sequences[0].element;\n                        this.currentCV[scopeBits[0]] = null;\n                    }\n                } else if ([\"pubChapter\", \"pubVerse\", \"altChapter\", \"altVerse\"].includes(scopeBits[0])) {\n                    if (item.subType === 'start') {\n                        const mark = {\n                            type: \"mark\",\n                            subType: camelCaseToSnakeCase(scopeBits[0]),\n                            atts: {\n                                number: scopeBits[1]\n                            }\n                        };\n                        environment.context.sequences[0].element = mark;\n                        this.renderEvent('mark', environment);\n                        delete environment.context.sequences[0].element;\n                    }\n                } else if (scopeBits[0] === 'span') {\n                    const wrapper = {\n                        type: \"wrapper\",\n                        subType: `usfm:${scopeBits[1]}`,\n                        atts: {}\n                    };\n                    environment.context.sequences[0].element = wrapper;\n                    if (item.subType === 'start') {\n                        environment.context.sequences[0].block.wrappers.unshift(wrapper.subType);\n                        this.renderEvent('startWrapper', environment);\n                    } else {\n                        this.renderEvent('endWrapper', environment);\n                        environment.context.sequences[0].block.wrappers.shift();\n                    }\n                    delete environment.context.sequences[0].element;\n                } else if (scopeBits[0] === 'spanWithAtts') {\n                    if (item.subType === 'start') {\n                        this._container = {\n                            direction: \"start\",\n                            type: \"wrapper\",\n                            subType: `usfm:${scopeBits[1]}`,\n                            atts: {}\n                        };\n                    }\n                } else if (scopeBits[0] === 'milestone' && item.subType === \"start\") {\n                    if (scopeBits[1] === 'ts') {\n                        const mark = {\n                            type: \"mark\",\n                            subType: `usfm:${camelCaseToSnakeCase(scopeBits[1])}`,\n                            atts: {}\n                        };\n                        environment.context.sequences[0].element = mark;\n                        this.renderEvent('mark', environment);\n                        delete environment.context.sequences[0].element;\n                    } else {\n                        this._container = {\n                            type: \"start_milestone\",\n                            subType: `usfm:${camelCaseToSnakeCase(scopeBits[1])}`,\n                            atts: {}\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    maybeRenderText(environment) {\n        if (this._tokens.length === 0) {\n            return;\n        }\n        const elementContext = {\n            type: 'text',\n            text: this._tokens.join(''),\n        };\n        environment.context.sequences[0].element = elementContext;\n        this._tokens = [];\n        this.renderEvent('text', environment);\n        delete environment.context.sequences[0].element;\n    }\n\n    renderContainer(environment) {\n        if (this._container.type === \"wrapper\") {\n            const direction = this._container.direction;\n            delete this._container.direction;\n            if (direction === 'start') {\n                environment.context.sequences[0].element = this._container;\n                environment.context.sequences[0].block.wrappers.unshift(this._container.subType);\n                this.renderEvent('startWrapper', environment);\n                delete environment.context.sequences[0].element;\n            } else {\n                environment.context.sequences[0].element = this._container;\n                this.renderEvent('endWrapper', environment);\n                environment.context.sequences[0].block.wrappers.shift();\n                delete environment.context.sequences[0].element;\n            }\n        } else if (this._container.type === \"start_milestone\") {\n            environment.context.sequences[0].element = this._container;\n            this.renderEvent('startMilestone', environment);\n            delete environment.context.sequences[0].element;\n        } else if (this._container.type === \"end_milestone\") {\n            environment.context.sequences[0].element = this._container;\n            this.renderEvent('endMilestone', environment);\n            delete environment.context.sequences[0].element;\n        }\n        this._container = null;\n    }\n\n}\nexport {SofriaRenderFromProskomma2};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}